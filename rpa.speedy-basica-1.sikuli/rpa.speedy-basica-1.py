import datetime
import os 
import glob
import shutil

desde = datetime.datetime.now() + datetime.timedelta(days=-3)
hasta = datetime.datetime.now()
ftpip = "10.4.3.220"
user_gestel = "ot_clvc2"
pass_gestel = "LV0220"
ftpruta = "/home/geslis/ot_clvc2"
link_inguz = "http://www.anovo.pe/inguz"
link_carga = "http://www.anovo.pe/inguz/formRutinas/frmCargarOrdenes.aspx"
user_inguz = "74590179"
pass_inguz = "jarvis"
basica = (r'\\10.120.15.48\CargaInguz\Basica')
speedy = (r'\\10.120.15.48\CargaInguz\Speedy')
delete_basica = (r'C:\CargaInguz\Basica\*')
delete_speedy = (r'C:\CargaInguz\Speedy\*')
print(desde)
print(hasta)

print("cerrar procesos")
os.system('taskkill /f /im cms.exe')
os.system('taskkill /f /im te_envot.exe')
os.system('taskkill /f /im te_banpai.exe')
os.system('taskkill /f /im te_manot.exe')
os.system('taskkill /f /im firefox.exe')
sleep(2)

print("Eliminar Archivos")
dfiles1 = glob.glob(delete_basica) 
for f in dfiles1:
    os.remove(f)
sleep(2)

dfiles2 = glob.glob(delete_speedy) 
for f in dfiles2:
    os.remove(f)
sleep(2)

print("abrir gestel")
App.open("C:\\Anzio126\\anzio32.exe")
sleep(2)
wait("1581453480121.png",60)
sleep(2)

print("iniciar sesion")
type(user_gestel)
sleep(2)
type(Key.ENTER)
sleep(2)
type(pass_gestel)
sleep(2)
type(Key.ENTER)
sleep(20)
type("n")
sleep(2)
type(Key.ENTER)
sleep(3)
type("s")
sleep(3)
type(Key.ENTER)
sleep(3)
type(Key.ENTER)
sleep(3)
print("fin ingreso gestel")

#//-----------------------------SPEEDY-----------------------
print("buscar la ruta")
sleep(1)
type(Key.F6)
sleep(2)
type("5C81")
sleep(1)
type(Key.ENTER)
sleep(3)
type("1")
sleep(1)
type(Key.ENTER)
sleep(3)
type("lim")
sleep(1)
type(Key.ENTER)
sleep(3)
type(Key.ENTER)
sleep(3)
type("00990")
sleep(1)
type(Key.ENTER)
sleep(3)
type("t")
sleep(2)
type("t")
sleep(2)
type(Key.ENTER)
sleep(2)
type(Key.ENTER)
sleep(2)
type("c")
sleep(1)
type(Key.ENTER)
sleep(60)

print("esperar reporte")
type(Key.ENTER)
sleep(1)
type("q")
sleep(1)
type(Key.ENTER)
sleep(1)

print("salir")
type(Key.ENTER)
sleep(1)
type(Key.DELETE)
sleep(5)

#//-----------------------------BASICA----------------//#
print("BASICA")
type("592")
sleep(1)
type(Key.ENTER)
sleep(3)
type(Key.RIGHT*3)
sleep(1)
type(Key.ENTER)
sleep(1)
type(Key.DOWN*7)
sleep(1)
type(Key.ENTER)
sleep(1)
type(Key.ENTER)
sleep(1)
type("n")
sleep(2)
type(Key.ENTER)
sleep(1)
type(Key.DOWN*9)
sleep(1)
type(Key.ENTER)
sleep(1)
type(Key.ENTER)
sleep(2)
type("n")
sleep(3)

print("filtrar fechas")
#type(Key.ENTER)
type(desde.strftime("%d-%m-%Y"))
sleep(2)
type(Key.ENTER)
sleep(2)
type(Key.ENTER)
sleep(5)
type(Key.ENTER)
sleep(3)
type(Key.DOWN)
sleep(2)
type(Key.ENTER)
sleep(3)

print("esperar reporte basica")
wait("1566415528183.png",1800)
sleep(2)
type(Key.F10)
sleep(2)
type("d")
sleep(2)
type(Key.ENTER)
sleep(2)
type("q")
sleep(1)
type(Key.ENTER)
sleep(1)

print("salir gestel")
type(Key.DELETE)
sleep(2)
type("x",KEY_ALT)
sleep(3)

#//--------------------FILEZILLA-------------------
print("abrir filezilla")
type("r",KeyModifier.WIN)
sleep(2)
paste(r'C:\Program Files\FileZilla FTP Client\filezilla.exe')
type(Key.ENTER)
sleep(1)
wait(Pattern("1560792641291.png").similar(0.80),3600)
sleep(2)

print("ingresar valores ftp")
paste(Pattern("1561489928485.png").targetOffset(28,23), ftpip)
sleep(1)
paste(Pattern("1561489962275.png").targetOffset(57,1), user_gestel)
sleep(1)
paste(Pattern("1561489995114.png").targetOffset(36,1), pass_gestel)
sleep(1)
type(Key.ENTER)
sleep(2)

print("esperar conexcion exitosa")
wait("1561490814279.png")
paste(Pattern("1561490869608.png").targetOffset(52,2) ,ftpruta)
sleep(1)
type(Key.ENTER)
sleep(2)
wait(Pattern("1561495055723-1.png").similar(0.80),120)
sleep(2)

print("ABRIR BASICA")
rightClick(Pattern("1561495124206-1.png").similar(0.90).targetOffset(1,1))
click(Pattern("1561495155754-1.png").targetOffset(-4,0))
sleep(3)
wait(Pattern("1561495460299-1.png").similar(0.80),120)
sleep(2)

print("guardar el archivo BASICA")
click(Pattern("1562170645601-1.png").targetOffset(-99,-10))
sleep(3)
click(Pattern("1562170689397-1.png").targetOffset(-15,45))
sleep(3)
wait(Pattern("1561504827141-1.png").similar(0.80),120)
sleep(2)
paste("basica")
sleep(2)
type("l",KEY_CTRL)
sleep(2)
paste(basica)
sleep(2)
type(Key.ENTER)

print("Guardar")
sleep(2)
click(Pattern("1561506442009-1.png").targetOffset(0,3))
sleep(2)
click(Pattern("1561506544814-2.png").targetOffset(41,1))

if exists ("1575399822535.png",15):
    sleep(2)
    click(Pattern("1575399822535.png").targetOffset(125,1))
    sleep(2)

print("abrir en excel")
type("r",KeyModifier.WIN)
sleep(2)
paste("excel")
type(Key.ENTER)
sleep(1)
wait(Pattern("1562171175271-1.png").similar(0.80),120)
sleep(2)

print("abrir el archivo basica")
type("q",KEY_ALT)
sleep(3)
type("o",KEY_ALT)
sleep(1)
wait(Pattern("1562185548317-1.png").similar(0.80),120)
sleep(1)
type("l",KEY_CTRL)
sleep(1)
paste(basica)
type(Key.ENTER)
sleep(1)
click(Pattern("1562184036061-1.png").targetOffset(85,2))
click(Pattern("1562184171093-1.png").targetOffset(-24,13))
click(Pattern("1562184198457-1.png").targetOffset(-25,15))
type(Key.ENTER)
sleep(2)

print("abrir basica ")
wait(Pattern("1562184472917.png").similar(0.80),120)
click(Pattern("1562185610688.png").targetOffset(-1,2))
sleep(2)
wait(Pattern("1562185659779.png").similar(0.80),120)
sleep(2)
click(Pattern("1562185756215-1.png").targetOffset(-41,11))
sleep(2)

def eliminar():
    click(Pattern("1562185712184-1.png").targetOffset(8,-10))
    sleep(1)

eliminar()
eliminar()
eliminar()
eliminar()
eliminar()

sleep(2)
click(Pattern("1562187271911-1.png").targetOffset(0,13))
sleep(2)
eliminar()
sleep(2)

print("Guardar Archivo")
type("a",KEY_ALT)
sleep(2)
type("v",KEY_ALT)
sleep(2)
type("o",KEY_ALT)
wait(Pattern("1562187507700-1.png").similar(0.80),120)
sleep(2)
type("basica")
sleep(2)
type(Key.TAB)
sleep(2)
type(Key.DOWN)
sleep(2)
type(Key.UP*8)
sleep(2)
type(Key.ENTER)
sleep(3)
type("l",KEY_CTRL)
sleep(2)
paste(basica)
sleep(1)
type(Key.ENTER)
sleep(2)
click(Pattern("1562187840588-2.png").targetOffset(-1,1))
sleep(5)
click(Pattern("1566418579850.png").targetOffset(47,1))
sleep(5)

if exists ("1575399822535.png",15):
    sleep(2)
    click(Pattern("1575399822535.png").targetOffset(125,1))
    sleep(2)

print("ABRIR SPEEDY")
rightClick(Pattern("1566418891877.png").similar(0.80).targetOffset(0,1))
click(Pattern("1561495155754-1.png").targetOffset(-4,0))
sleep(3)
wait(Pattern("1561495460299-1.png").similar(0.80),120)
sleep(2)

print("guardar el archivo BASICA")
click(Pattern("1566420551366.png").targetOffset(-97,-9))
sleep(3)
click(Pattern("1562170689397-1.png").targetOffset(-15,45))
sleep(3)
wait(Pattern("1561504827141-1.png").similar(0.80),120)
sleep(2)
paste("speedy")
sleep(2)
type("l",KEY_CTRL)
sleep(2)
paste(speedy)
sleep(2)
type(Key.ENTER)

print("Guardar")
sleep(2)
click(Pattern("1561506442009-1.png").targetOffset(0,3))
sleep(2)
click(Pattern("1561506544814-2.png").targetOffset(41,1))

if exists ("1575398954726.png",15):
    sleep(2)
    click(Pattern("1575398954726.png").targetOffset(140,0))
    sleep(2)

print("abrir en excel")
type("r",KeyModifier.WIN)
sleep(2)
paste("excel")
type(Key.ENTER)
sleep(1)
wait(Pattern("1562171175271-1.png").similar(0.80),120)
sleep(2)

print("abrir el archivo basica")
type("q",KEY_ALT)
sleep(3)
type("o",KEY_ALT)
sleep(1)
wait(Pattern("1562185548317-1.png").similar(0.80),120)
sleep(1)
type("l",KEY_CTRL)
sleep(1)
paste(speedy)
type(Key.ENTER)
sleep(1)
click(Pattern("1562184036061-1.png").targetOffset(85,2))
click(Pattern("1562184171093-1.png").targetOffset(-24,13))
click(Pattern("1566420715962.png").targetOffset(-23,15))
sleep(2)
type(Key.ENTER)
sleep(2)

print("abrir basica ")
wait(Pattern("1562184472917.png").similar(0.80),120)
click(Pattern("1566421265819.png").targetOffset(-36,-10))
sleep(2)
type("s")
sleep(2)
type("o")
sleep(2)
paste(r'|')
sleep(2)
type(Key.ENTER)
sleep(2)
type(Key.ENTER)
sleep(2)
wait(Pattern("1566421961209.png").targetOffset(4,-1),120)
sleep(2)

print("Guardar Archivo")
type("a",KEY_ALT)
sleep(2)
type("v",KEY_ALT)
sleep(2)
type("o",KEY_ALT)
wait(Pattern("1562187507700-1.png").similar(0.80),120)
sleep(2)
type("speedy")
sleep(2)
type(Key.TAB)
sleep(2)
type(Key.DOWN)
sleep(2)
type(Key.UP*8)
type(Key.ENTER)
sleep(3)
type("l",KEY_CTRL)
sleep(2)
paste(speedy)
sleep(1)
type(Key.ENTER)
sleep(2)
click(Pattern("1562187840588-2.png").targetOffset(-1,1))
sleep(5)
click(Pattern("1566418579850.png").targetOffset(47,1))
sleep(5)

if exists ("1575398954726.png",15):
    sleep(2)
    click(Pattern("1575398954726.png").targetOffset(140,0))
    sleep(2)

print("cerrar FileZilla")
click(Pattern("1566422786894.png").targetOffset(71,-8))
sleep(3)
type("q",KEY_CTRL)
sleep(5)


#//--------------------FIREFOX-------------------//#
print("abrir firefox")
App.open("C:\\Program Files\\Mozilla Firefox\\firefox.exe")
sleep(15)

print("iniciar sesion")
paste(Pattern("1566427253659.png").targetOffset(-224,25), user_inguz)
sleep(2)
type(Key.TAB)
sleep(2)
paste(pass_inguz)
sleep(2)
type(Key.ENTER)
sleep(2)
wait("1571938509436.png",60)
sleep(2)
type("l",KEY_CTRL)
sleep(2)
paste(link_carga)
sleep(2)
type(Key.ENTER)
sleep(10)
click(Pattern("1566427365594.png").similar(0.80).targetOffset(11,-24))
sleep(3)
type(Key.DOWN*11)
sleep(3)
click(Pattern("1571416218113-2.png").similar(0.80).targetOffset(-159,18))
sleep(5)

print("buscar el archivo")
type("l",KEY_CTRL)
sleep(2)
paste(speedy)
sleep(2)
type(Key.ENTER)
sleep(2)
click(Pattern("1569338885840-1.png").similar(0.90).targetOffset(-21,0))
sleep(1)
type(Key.ENTER)
sleep(2)
click(Pattern("1571416291001-2.png").similar(0.80).targetOffset(322,52))
sleep(3)
wait(Pattern("1560615777602.png").similar(0.80),600)

print("fin de la carga")
sleep(3)
type("w",KEY_CTRL)
sleep(3)

files1 = glob.glob('C:\\CargaInguz\\Basica\\*') 
for f in files1:
    shutil.copy(f,'\\\\10.10.1.250\\Desarrollo\\CargaInguz_Gestel\\')

files2 = glob.glob('C:\\CargaInguz\Speedy\\*') 
for fi in files2:
    shutil.copy(fi,'\\\\10.10.1.250\\Desarrollo\\CargaInguz_Gestel\\')